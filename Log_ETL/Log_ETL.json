{"paragraphs":[{"text":"%md\n# Data Propcessing (Manual ETL)\nThe following demonstrates a script that can be leveraged to clean and transform __log__ data. this can be further leveraged as __GLue ETL__ job.\n## Load necessary Libraries","dateUpdated":"2018-06-17T21:06:22+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Data Propcessing (Manual ETL)</h1>\n<p>The following demonstrates a script that can be leveraged to clean and transform <strong>log</strong> data. this can be further leveraged as <strong>GLue ETL</strong> job.</p>\n<h2>Load necessary Libraries</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1529269487661_-1502797816","id":"20180617-200948_1817247607","dateCreated":"2018-06-17T21:04:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3153","user":"admin","dateFinished":"2018-06-17T21:06:22+0000","dateStarted":"2018-06-17T21:06:22+0000"},{"text":"# Configuration\nimport sys\nfrom awsglue.transforms import *\nfrom awsglue.utils import getResolvedOptions\nfrom pyspark.context import SparkContext\nfrom awsglue.context import GlueContext\nfrom awsglue.job import Job\nglueContext = GlueContext(spark.sparkContext)\n","dateUpdated":"2018-06-17T21:08:25+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1529269487664_-1491640098","id":"20180617-182907_964223239","dateCreated":"2018-06-17T21:04:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3154","user":"admin","dateFinished":"2018-06-17T21:08:25+0000","dateStarted":"2018-06-17T21:08:25+0000"},{"text":"%md\n## Create a Dynamic DataFrame - Extract","dateUpdated":"2018-06-17T21:07:10+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Create a Dynamic DataFrame - Extract</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1529269487664_-1491640098","id":"20180617-201028_430832325","dateCreated":"2018-06-17T21:04:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3155","user":"admin","dateFinished":"2018-06-17T21:07:10+0000","dateStarted":"2018-06-17T21:07:10+0000"},{"text":"# Load the Table as a dynamic DataFrame\ndatasource0 = glueContext.create_dynamic_frame.from_catalog(database = \"gopro\", table_name = \"ecs_var_lib_docker_containers_64a2bb184180d6c22efbc6d25d685bc2bb12968553a69f058d0e3fecad5d902b_qa_entitlements_manager_entitl...\", transformation_ctx = \"datasource0\")\n\n# Displayy Schema\ndatasource0.printSchema()","dateUpdated":"2018-06-17T21:08:28+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n|-- container: string\n|-- qa-entitlements-manager: choice\n|    |-- string\n|    |-- struct\n|    |    |-- method: string\n|    |    |-- path: string\n|    |    |-- format: string\n|    |    |-- controller: string\n|    |    |-- action: string\n|    |    |-- status: int\n|    |    |-- duration: double\n|    |    |-- view: double\n|    |    |-- db: double\n|    |    |-- gpuid: null\n|    |    |-- scopes: null\n|    |    |-- user_agent: null\n|    |    |-- remote_ip: null\n|    |    |-- params: struct\n|    |    |-- timestamp: string\n|    |    |-- hostname: string\n|-- tag: string\n|-- partition_0: string\n|-- partition_1: string\n|-- partition_2: string\n\n"}]},"apps":[],"jobName":"paragraph_1529269487665_-1492024847","id":"20180617-183032_1491844533","dateCreated":"2018-06-17T21:04:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3156","user":"admin","dateFinished":"2018-06-17T21:08:43+0000","dateStarted":"2018-06-17T21:08:28+0000"},{"text":"%md\nDynamicFrames introduce the notion of a `choice` type. In this case, it shows that both `string` and `struct` may appear in that column. The Spark DataFrame considered the whole dataset, but was forced to assign the most general type to the column (string). In fact, Spark often resorts to the most general case when there are complex types or variations with which it is unfamiliar. To query the `qa-entitlements-manager`, we need to firstly \"resolve\" the choice, thus we sill use the `cast` method to transform the \"choice\" to `struct`.\n\n## Using the `cast` option to `ResolveChoice` Class - Transform\nUsing the `cast` method, the data is automatically converted to a structured format","dateUpdated":"2018-06-17T21:08:48+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>DynamicFrames introduce the notion of a <code>choice</code> type. In this case, it shows that both <code>string</code> and <code>struct</code> may appear in that column. The Spark DataFrame considered the whole dataset, but was forced to assign the most general type to the column (string). In fact, Spark often resorts to the most general case when there are complex types or variations with which it is unfamiliar. To query the <code>qa-entitlements-manager</code>, we need to firstly &ldquo;resolve&rdquo; the choice, thus we sill use the <code>cast</code> method to transform the &ldquo;choice&rdquo; to <code>struct</code>.</p>\n<h2>Using the <code>cast</code> option to <code>ResolveChoice</code> Class - Transform</h2>\n<p>Using the <code>cast</code> method, the data is automatically converted to a structured format</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1529269487665_-1492024847","id":"20180617-201510_1419389279","dateCreated":"2018-06-17T21:04:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3157","user":"admin","dateFinished":"2018-06-17T21:08:48+0000","dateStarted":"2018-06-17T21:08:48+0000"},{"text":"# Resolve `choice` using cast\nresolvechoice1 = ResolveChoice.apply(frame = datasource0, specs = [('qa-entitlements-manager','cast:struct')], transformation_ctx = \"resolvechoice1\")\n\n# Display transformed schema\nresolvechoice1.printSchema()","dateUpdated":"2018-06-17T21:08:53+0000","config":{"tableHide":false,"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n|-- container: string\n|-- qa-entitlements-manager: struct\n|    |-- method: string\n|    |-- path: string\n|    |-- format: string\n|    |-- controller: string\n|    |-- action: string\n|    |-- status: int\n|    |-- duration: double\n|    |-- view: double\n|    |-- db: double\n|    |-- gpuid: null\n|    |-- scopes: null\n|    |-- user_agent: null\n|    |-- remote_ip: null\n|    |-- params: struct\n|    |-- timestamp: string\n|    |-- hostname: string\n|-- tag: string\n|-- partition_0: string\n|-- partition_1: string\n|-- partition_2: string\n\n"}]},"apps":[],"jobName":"paragraph_1529269487666_-1490870600","id":"20180617-183252_1435099979","dateCreated":"2018-06-17T21:04:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3158","user":"admin","dateFinished":"2018-06-17T21:08:53+0000","dateStarted":"2018-06-17T21:08:53+0000"},{"text":"%md\n## Removing `null` Values - Transform\nAs can be seen from the Schema output above, there are `null` values. The __Dynamic DataFrame__ supports the ability to remove the `null` values by using the `DropNullFields` method.","dateUpdated":"2018-06-17T21:09:00+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Removing <code>null</code> Values - Transform</h2>\n<p>As can be seen from the Schema output above, there are <code>null</code> values. The <strong>Dynamic DataFrame</strong> supports the ability to remove the <code>null</code> values by using the <code>DropNullFields</code> method.</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1529269487667_-1491255349","id":"20180617-202000_268481168","dateCreated":"2018-06-17T21:04:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3159","user":"admin","dateFinished":"2018-06-17T21:09:00+0000","dateStarted":"2018-06-17T21:09:00+0000"},{"text":"# Remove null fields\ndropnullfields3 = DropNullFields.apply(frame = resolvechoice1, transformation_ctx = \"dropnullfields3\")\n\n# Display \"clean\" schema\ndropnullfields3.printSchema()","dateUpdated":"2018-06-17T21:09:05+0000","config":{"tableHide":false,"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"null_fields [u'qa-entitlements-manager.gpuid', u'qa-entitlements-manager.scopes', u'qa-entitlements-manager.user_agent', u'qa-entitlements-manager.remote_ip']\nroot\n|-- container: string\n|-- qa-entitlements-manager: struct\n|    |-- method: string\n|    |-- path: string\n|    |-- format: string\n|    |-- controller: string\n|    |-- action: string\n|    |-- status: int\n|    |-- duration: double\n|    |-- view: double\n|    |-- db: double\n|    |-- timestamp: string\n|    |-- hostname: string\n|-- tag: string\n|-- partition_0: string\n|-- partition_1: string\n|-- partition_2: string\n\n"}]},"apps":[],"jobName":"paragraph_1529269487667_-1491255349","id":"20180617-185158_1398567366","dateCreated":"2018-06-17T21:04:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3160","user":"admin","dateFinished":"2018-06-17T21:09:05+0000","dateStarted":"2018-06-17T21:09:05+0000"},{"text":"%md\n## Formatting Column Headers - Transform","dateUpdated":"2018-06-17T21:14:29+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Formatting Column Headers - Transform</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1529269487668_-1493179094","id":"20180617-202323_516805797","dateCreated":"2018-06-17T21:04:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3161","user":"admin","dateFinished":"2018-06-17T21:14:29+0000","dateStarted":"2018-06-17T21:14:29+0000"},{"text":"# Column headers formatting\napplymapping4 = ApplyMapping.apply(frame = dropnullfields3, mappings = [(\"container\", \"string\", \"container\", \"string\"), \\\n(\"qa-entitlements-manager.method\", \"string\", \"method\", \"string\"), \\\n(\"qa-entitlements-manager.format\", \"string\", \"format\", \"string\"), \\\n(\"qa-entitlements-manager.controller\", \"string\", \"controller\", \"string\"), \\\n(\"qa-entitlements-manager.action\", \"string\", \"action\", \"string\"), \\\n(\"qa-entitlements-manager.status\", \"int\", \"status\", \"int\"), \\\n(\"qa-entitlements-manager.duration\", \"double\", \"duration\", \"double\"), \\\n(\"qa-entitlements-manager.view\", \"double\", \"view\", \"double\"), \\\n(\"qa-entitlements-manager.db\", \"double\", \"db\", \"double\"), \\\n(\"qa-entitlements-manager.timestamp\", \"string\", \"timestamp\", \"string\"), \\\n(\"qa-entitlements-manager.hostname\", \"string\", \"hostname\", \"string\"), \\\n(\"tag\", \"string\", \"tag\", \"string\")], transformation_ctx = \"applymapping4\")\n\n# Display \"clean\" schema\napplymapping4.printSchema()","dateUpdated":"2018-06-17T21:09:58+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n|-- container: string\n|-- method: string\n|-- format: string\n|-- controller: string\n|-- action: string\n|-- status: int\n|-- duration: double\n|-- view: double\n|-- db: double\n|-- timestamp: string\n|-- hostname: string\n|-- tag: string\n\n"}]},"apps":[],"jobName":"paragraph_1529269487669_-1493563842","id":"20180617-202326_691430977","dateCreated":"2018-06-17T21:04:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3162","user":"admin","dateFinished":"2018-06-17T21:09:58+0000","dateStarted":"2018-06-17T21:09:58+0000"},{"text":"%md\n## Write the Transformed Data to S3 - Load","dateUpdated":"2018-06-17T21:10:03+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Write the Transformed Data to S3 - Load</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1529269487670_-1492409596","id":"20180617-203034_280325124","dateCreated":"2018-06-17T21:04:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3163","user":"admin","dateFinished":"2018-06-17T21:10:03+0000","dateStarted":"2018-06-17T21:10:03+0000"},{"text":"dataoutput = glueContext.write_dynamic_frame.from_options(frame = applymapping4, connection_type = \"s3\", connection_options = {\"path\": \"s3://athena-hol-722812380636-us-west-2/etl-output\"}, format = \"orc\", transformation_ctx = \"dataoutput\")","dateUpdated":"2018-06-17T21:10:52+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1529269487670_-1492409596","id":"20180617-183847_1842803014","dateCreated":"2018-06-17T21:04:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3164","user":"admin","dateFinished":"2018-06-17T21:10:54+0000","dateStarted":"2018-06-17T21:10:53+0000"}],"name":"Log_ETL","id":"2DK6J2V6W","angularObjects":{"2CRE5X63N:shared_process":[],"2CQZ9JC8F:shared_process":[],"2CNAPD13W:shared_process":[],"2CRC324G8:existing_process":[],"2CQ1X8PFU:shared_process":[],"2CNFC7TNE:shared_process":[],"2CMQ2EHTE:shared_process":[],"2CQUCJVJA:shared_process":[],"2CQY3SUDK:shared_process":[],"2CNA37GFQ:shared_process":[],"2CPH9H73W:shared_process":[],"2CR2XFEE3:shared_process":[],"2CQ9YVF7W:shared_process":[],"2CP1P36EU:shared_process":[],"2CMR9MKCE:shared_process":[],"2CR2YZBFW:shared_process":[],"2CPJK4U6W:shared_process":[],"2CR2Z9UR2:shared_process":[],"2CPQWHWM3:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}